{{ $styles := .Site.Data.classnames }}
{{ $dirVersion := .File.Dir }}
{{ $dirVersion = split $dirVersion "/" }}
{{ $dirVersion = index $dirVersion 1 }}

<aside>
	{{ range .FirstSection.Pages }}
		{{ $pageVersion := split .Page.RelPermalink "/" }}
		{{ $pageVersion = index $pageVersion 2 }}
		{{ if eq $pageVersion $dirVersion }}
			{{ template "menu-level" (dict "Pages" .Pages "Site" .Site) }}
		{{ end }}
	{{ end }}
</aside>

{{ define "menu-level" }}
	{{ $styles := .Site.Data.classnames }}
	<ul class="{{ $styles.sidebarMenu }}">
		{{ range .Pages }}
			{{ if .IsPage }}
				<li><a href="{{ .RelPermalink }}" class="{{ $styles.sidebarMenuLink }}">{{ .LinkTitle }}</a></li>
			{{ else }}
				<li>
					<a href="{{ .RelPermalink }}">{{ .LinkTitle }}</a>
					{{ template "menu-level" (dict "Pages" .Pages "Version" $.Version "Site" .Site)}}
				</li>
			{{ end }}
		{{ end }}
	</ul>
{{ end }}

